<ion-header translucent>
    <ion-toolbar>
        <ion-title>Scan Files</ion-title>
        <ion-buttons slot="end">
            <ion-button (click)="dismiss()">Close</ion-button>
        </ion-buttons>
    </ion-toolbar>
    <!-- <ion-progress-bar [value]="(uploadPercent | async)"></ion-progress-bar> -->
</ion-header>
<ion-content fullscreen>
    <ion-list class="theme--list" lines="none">
        <ion-list-header>
            Choose Folder
        </ion-list-header>

        <ion-radio-group allow-empty-selection [(ngModel)]="folder">
            <div *ngIf="sourceId === 'files'">
                <div *ngFor="let g of (groups$ | async); let i = index">
                    <ion-item lines="none" detail="false" class="theme--item">
                        <ion-avatar slot="start">
                            <ngx-avatar name="{{ g.name }}" [size]="40"></ngx-avatar>
                        </ion-avatar>
                        <ion-label>
                            <h2>{{ g.name }}</h2>
                            <h3>{{ g.members.length > 1 ? g.members.length + ' Members' : g.members.length + ' Member' }}
                            </h3>
                        </ion-label>
                        <ion-radio slot="end" color="primary" [value]="g"></ion-radio>
                        <!-- <ion-checkbox slot="end" [(ngModel)]="g.isChecked"></ion-checkbox> -->
                    </ion-item>
                </div>
            </div>

            <div *ngFor="let m of (members$ | async); let i = index">
                <ion-item lines="none" detail="false" *ngIf="sourceId === 'files' && m.profile && m.uid !== (profile$ | async)?.uid || sourceId === m.uid" class="theme--item">
                    <ion-avatar slot="start">
                        <img *ngIf="m.profile.url; else elseMemberAvatar" src="{{ m.profile.url }}">
                        <ng-template #elseMemberAvatar>
                            <ngx-avatar name="{{ m.profile.displayName }}" [size]="40"></ngx-avatar>
                        </ng-template>
                    </ion-avatar>
                    <ion-label>
                        <h2>{{ m.profile.displayName }}</h2>
                        <h3>2 Members</h3>
                    </ion-label>
                    <ion-radio slot="end" color="primary" [value]="m"></ion-radio>
                    <!-- <ion-checkbox slot="end" [(ngModel)]="m.isChecked"></ion-checkbox> -->
                </ion-item>
            </div>
            <div *ngFor="let m of (members$ | async); let i = index">
                <ion-item lines="none" detail="false" *ngIf="sourceId === 'files' && m.profile && m.uid === (profile$ | async)?.uid" class="theme--item">
                    <ion-avatar slot="start">
                        <img *ngIf="m.profile.url; else elseMemberAvatar" src="{{ m.profile.url }}">
                        <ng-template #elseMemberAvatar>
                            <ngx-avatar name="{{ m.profile.displayName }}" [size]="40"></ngx-avatar>
                        </ng-template>
                    </ion-avatar>
                    <ion-label>
                        <h2>{{ m.profile.displayName }}</h2>
                        <h3>1 Member</h3>
                    </ion-label>
                    <ion-radio slot="end" color="primary" [value]="m"></ion-radio>
                    <!-- <ion-checkbox slot="end" [(ngModel)]="m.isChecked"></ion-checkbox> -->
                </ion-item>
            </div>

        </ion-radio-group>

        <ion-list-header>
            Scan Files
        </ion-list-header>

        <ion-item class="theme--item" lines="none">
            <ion-note>Scans are best on high-contrast surfaces</ion-note>
        </ion-item>

        <div *ngIf="error">
            <div class="error" *ngIf="error">
                {{ error }}
            </div>
        </div>

        <div class="ion-padding">
            <ion-button (click)="addScan()" expand="block">Add Scan</ion-button>
        </div>

        <div *ngIf="scans.length" lines="none">
            <ion-list-header>
                Uploads
            </ion-list-header>

            <ion-item class="theme--item" lines="none">
                <ion-note>Press thumbnails to preview scans</ion-note>
            </ion-item>

            <div *ngFor="let s of scans; let i = index" lines="none">
                <upload-task *ngIf="s" [teamId]="teamId" [folder]="folder" [file]="s.file" [scan]="s"></upload-task>
            </div>
        </div>

    </ion-list>
</ion-content>

<ion-footer>
    <ion-toolbar>
        <ion-row class="ion-justify-content-center">
            <ion-button color="danger" (click)="reset()" expand="block">Reset</ion-button>
            <ion-button (click)="dismiss()" expand="block">Done</ion-button>
        </ion-row>
    </ion-toolbar>
</ion-footer>